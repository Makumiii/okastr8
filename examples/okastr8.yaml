# ==============================================
# OKASTR8.YAML - Application Deployment Config
# ==============================================
# Place this file in your repository root.
# Okastr8 uses it to build and deploy your app.

# Runtime (optional - auto-detected if omitted)
# Supported: node, python, go, bun, deno
# Can include version: "node:22", "python:3.12"
runtime: node

# Port your application listens on (required)
port: 3000

# Command to start your application (required)
start: npm start

# Custom domain for reverse proxy (optional)
domain: myapp.example.com

# Use Cloudflare Tunnel routing (optional)
# Set to true to bypass Caddy and run an isolated sidecar agent.
# Requires TUNNEL_TOKEN to be set in the app environment.
tunnel_routing: false

# Build commands (optional)
# Run in order before starting the application
build:
    - npm install
    - npm run build

# Managed database (optional)
# Triggers Docker Compose deployment
# Supported: postgres, mysql, mariadb, mongo
database: "postgres:15"

# Managed cache (optional)
# Triggers Docker Compose deployment
# Supported: redis
cache: "redis:7"

# Optional: publish built image after successful Git deployment (opt-in)
# This uses your saved registry credential id (from `okastr8 registry add`)
publish_image:
    enabled: false
    image: "ghcr.io/your-org/your-app:latest"
    registry_credential: "ghcr-main"

# ==============================================
# NOTE: Environment Variables
# ==============================================
# Do NOT put secrets in this file!
# This file is committed to your repository.
#
# Instead, add env vars via:
#   - Dashboard UI when deploying
#   - CLI: okastr8 app env set myapp KEY=VALUE
#   - CLI: okastr8 deploy trigger myapp --env-file .env.local
