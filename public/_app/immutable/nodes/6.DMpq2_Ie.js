import{d as je,f as d,a as r,s as L,c as M,t as Ne}from"../chunks/BesHKk2l.js";import{o as Ie}from"../chunks/CMSYLF-L.js";import{p as Oe,s as h,a as ce,t as re,b as Re,c as s,g as e,e as v,d as p,r as n,n as $,f as b,a5 as Ae,u as pe}from"../chunks/DcwGHiHW.js";import{a as Fe,i as C,b as He}from"../chunks/VPZc6XJw.js";import{e as me,i as fe}from"../chunks/D9-Fv5Cr.js";import{r as Ve,e as Ke}from"../chunks/sNASJAqg.js";import{a as Le,b as Me}from"../chunks/BKS9-7GM.js";import{b as Ye}from"../chunks/CJNNZX2I.js";import{p as Ge}from"../chunks/DPLqBrji.js";import{B as Je}from"../chunks/7OBOsxqh.js";import{C as se}from"../chunks/CcxZSFxj.js";import{p as oe,B as Y}from"../chunks/BhjZa1Ej.js";import"../chunks/CgBnaJbM.js";import{R as Ue,C as ue,X as We}from"../chunks/DdFlPsbk.js";import{T as Xe}from"../chunks/9JUkeufA.js";const qe=!1,Ea=Object.freeze(Object.defineProperty({__proto__:null,prerender:qe},Symbol.toStringTag,{value:"Module"}));var Qe=d('<div class="h-10 w-48 rounded bg-[var(--border)]"></div> <div class="mt-4 h-4 w-64 rounded bg-[var(--border)]"></div>',1),Ze=d("<option> </option>"),ea=d("<!> okastr8.yaml found",1),aa=d("<!> No okastr8.yaml found",1),ta=d('<div class="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"></div> Deploying...',1),ra=d("<!> Start Deploy",1),sa=d('<h2 class="text-lg font-semibold text-[var(--text-primary)]">Configuration</h2> <div class="mt-4"><label for="branch-select" class="mb-2 block text-sm font-medium text-[var(--text-primary)]">Branch</label> <select id="branch-select" class="w-full rounded-[var(--radius-md)] border border-[var(--border)] bg-white px-4 py-2.5 text-sm text-[var(--text-primary)] focus:border-[var(--primary)] focus:outline-none"></select></div> <div class="mt-4"><!></div> <div class="mt-4"><label class="flex items-center gap-3"><input type="checkbox" class="h-4 w-4 rounded border-[var(--border)] text-[var(--primary)] focus:ring-[var(--primary)]"/> <span class="text-sm text-[var(--text-primary)]">Enable auto-deploy on push</span></label></div> <div class="mt-4"><label for="env-vars" class="mb-2 block text-sm font-medium text-[var(--text-primary)]">Environment Variables (optional)</label> <textarea id="env-vars" placeholder="KEY=value ANOTHER_KEY=another_value" rows="4" class="w-full rounded-[var(--radius-md)] border border-[var(--border)] bg-white px-4 py-2.5 font-mono text-sm text-[var(--text-primary)] placeholder:text-[var(--text-muted)] focus:border-[var(--primary)] focus:outline-none"></textarea></div> <!>',1),oa=d("<!> Success",1),la=d("<!> Failed",1),na=d('<div class="h-2 w-2 animate-pulse rounded-full bg-yellow-500"></div> Deploying',1),ia=d('<p class="text-[var(--text-muted)]">Waiting to start deployment...</p>'),va=d('<p class="whitespace-pre-wrap"> </p>'),da=d('<a href="/apps" class="mt-4 inline-flex items-center justify-center gap-2 rounded-[var(--radius-md)] bg-[var(--success)] px-4 py-2.5 text-sm font-medium text-white transition-colors hover:bg-green-600">View Apps →</a>'),ca=d('<div class="flex items-center justify-between"><h2 class="text-lg font-semibold text-[var(--text-primary)]">Deployment Logs</h2> <!></div> <div class="mt-4 flex-1 overflow-auto rounded-[var(--radius-md)] bg-[var(--bg-terminal)] p-4 font-mono text-sm text-green-400" style="min-height: 300px; max-height: 400px;"><!></div> <!>',1),pa=d('<div class="grid gap-6 lg:grid-cols-2"><!> <!></div>'),ma=d('<div class="space-y-6"><div class="flex items-center gap-2 text-sm text-[var(--text-secondary)]"><a href="/github" class="hover:text-[var(--primary)]">GitHub</a> <span>→</span> <span class="font-medium text-[var(--text-primary)]"> </span></div> <div><h1 class="text-2xl font-bold text-[var(--text-primary)]"> </h1> <p class="mt-1 text-[var(--text-secondary)]"> </p></div> <!></div>');function Ta(_e,ge){Oe(ge,!0);const xe=()=>Fe(Ge,"$page",he),[he,be]=He(),D=decodeURIComponent(xe().params.repo??""),[fa,ye]=D.split("/");let G=h(ce([])),E=h(""),j=h(null),X=h(!0),J=h(""),le=h(!0),P=h(!1),ne=h(""),S=h(ce([])),N=h(!1),I=h(!1),O=h(void 0);Ie(()=>{$e()});async function $e(){const o=await oe("/github/branches",{repoFullName:D});o.success&&o.data?.branches&&(s(G,o.data.branches,!0),e(G).length>0&&(s(E,e(G)[0].name,!0),await ie())),s(le,!1)}async function ie(){s(j,null);const o=await oe("/github/check-config",{repoFullName:D,ref:e(E)});s(j,o.data?.hasConfig??!1,!0)}async function we(){if(!e(E)||e(P))return;s(P,!0),s(S,[],!0),s(N,!1),s(I,!1);const o={};e(J).trim()&&e(J).split(`
`).forEach(w=>{const[k,...R]=w.split("=");k&&(o[k.trim()]=R.join("=").trim())});const _=await oe("/github/import",{repoFullName:D,branch:e(E),webhookAutoDeploy:e(X),env:o});_.success&&_.data?.deploymentId?(s(ne,_.data.deploymentId,!0),ke()):(s(S,[`❌ Failed to start deployment: ${_.message}`],!0),s(P,!1))}function ke(){const o=new EventSource(`/api/github/deploy-stream/${e(ne)}`);o.onmessage=_=>{const w=JSON.parse(_.data);w.type==="log"?(s(S,[...e(S),w.message],!0),Ce()):w.type==="end"&&(o.close(),s(P,!1),s(N,!0),s(I,e(S).some(k=>k.includes("✅")||k.includes("succeeded")),!0))},o.onerror=()=>{o.close(),s(P,!1),s(N,!0)}}function Ce(){e(O)&&(e(O).scrollTop=e(O).scrollHeight)}var q=ma(),Q=v(q),ve=p(v(Q),4),Pe=v(ve,!0);n(ve),n(Q);var Z=p(Q,2),ee=v(Z),Se=v(ee);n(ee);var de=p(ee,2),Be=v(de);n(de),n(Z);var De=p(Z,2);{var Ee=o=>{se(o,{class:"animate-pulse p-8",children:(_,w)=>{var k=Qe();$(2),r(_,k)},$$slots:{default:!0}})},Te=o=>{var _=pa(),w=v(_);se(w,{children:(R,ze)=>{var A=sa(),B=p(b(A),2),T=p(v(B),2);T.__change=ie,me(T,21,()=>e(G),fe,(t,c)=>{var l=Ze(),i=v(l,!0);n(l);var y={};re(()=>{L(i,e(c).name),y!==(y=e(c).name)&&(l.value=(l.__value=e(c).name)??"")}),r(t,l)}),n(T),n(B);var F=p(B,2),ae=v(F);{var z=t=>{Y(t,{variant:"outline",children:(c,l)=>{$();var i=Ne("Checking okastr8.yaml...");r(c,i)},$$slots:{default:!0}})},te=t=>{var c=M(),l=b(c);{var i=g=>{Y(g,{variant:"success",class:"flex gap-1 items-center",children:(x,m)=>{var f=ea(),K=b(f);ue(K,{size:14}),$(),r(x,f)},$$slots:{default:!0}})},y=g=>{Y(g,{variant:"warning",class:"flex gap-1 items-center",children:(x,m)=>{var f=aa(),K=b(f);Xe(K,{size:14}),$(),r(x,f)},$$slots:{default:!0}})};C(l,g=>{e(j)?g(i):g(y,!1)},!0)}r(t,c)};C(ae,t=>{e(j)===null?t(z):t(te,!1)})}n(F);var H=p(F,2),U=v(H),W=v(U);Ve(W),$(2),n(U),n(H);var V=p(H,2),a=p(v(V),2);Ae(a),n(V);var u=p(V,2);{let t=pe(()=>e(P)||!e(j));Je(u,{class:"mt-6 w-full",onclick:we,get disabled(){return e(t)},children:(c,l)=>{var i=M(),y=b(i);{var g=m=>{var f=ta();$(),r(m,f)},x=m=>{var f=ra(),K=b(f);Ue(K,{size:16,class:"mr-2"}),$(),r(m,f)};C(y,m=>{e(P)?m(g):m(x,!1)})}r(c,i)},$$slots:{default:!0}})}Ke(T,()=>e(E),t=>s(E,t)),Le(W,()=>e(X),t=>s(X,t)),Me(a,()=>e(J),t=>s(J,t)),r(R,A)},$$slots:{default:!0}});var k=p(w,2);se(k,{class:"flex flex-col",children:(R,ze)=>{var A=ca(),B=b(A),T=p(v(B),2);{var F=a=>{{let u=pe(()=>e(I)?"success":"error");Y(a,{get variant(){return e(u)},class:"flex gap-1 items-center",children:(t,c)=>{var l=M(),i=b(l);{var y=x=>{var m=oa(),f=b(m);ue(f,{size:14}),$(),r(x,m)},g=x=>{var m=la(),f=b(m);We(f,{size:14}),$(),r(x,m)};C(i,x=>{e(I)?x(y):x(g,!1)})}r(t,l)},$$slots:{default:!0}})}},ae=a=>{var u=M(),t=b(u);{var c=l=>{Y(l,{variant:"warning",children:(i,y)=>{var g=na();$(),r(i,g)},$$slots:{default:!0}})};C(t,l=>{e(P)&&l(c)},!0)}r(a,u)};C(T,a=>{e(N)?a(F):a(ae,!1)})}n(B);var z=p(B,2),te=v(z);{var H=a=>{var u=ia();r(a,u)},U=a=>{var u=M(),t=b(u);me(t,17,()=>e(S),fe,(c,l)=>{var i=va(),y=v(i,!0);n(i),re(()=>L(y,e(l))),r(c,i)}),r(a,u)};C(te,a=>{e(S).length===0?a(H):a(U,!1)})}n(z),Ye(z,a=>s(O,a),()=>e(O));var W=p(z,2);{var V=a=>{var u=da();r(a,u)};C(W,a=>{e(N)&&e(I)&&a(V)})}r(R,A)},$$slots:{default:!0}}),n(_),r(o,_)};C(De,o=>{e(le)?o(Ee):o(Te,!1)})}n(q),re(()=>{L(Pe,D),L(Se,`Deploy ${ye??""}`),L(Be,`Configure and deploy from ${D??""}`)}),r(_e,q),Re(),be()}je(["change"]);export{Ta as component,Ea as universal};
