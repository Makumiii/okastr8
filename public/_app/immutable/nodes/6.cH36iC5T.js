import{d as Ne,f,a as o,s as j,c as W,t as R}from"../chunks/ISW6cSpQ.js";import{o as Te}from"../chunks/CcMilK9m.js";import{p as Ie,b as m,h as ce,t as q,a as Oe,s as r,g as e,d as n,c as v,r as i,n as $,f as N,ao as Ae,u as pe}from"../chunks/D5eA8VJ5.js";import{s as Fe,i as w,a as He}from"../chunks/D7wiL91P.js";import{e as ue,i as me}from"../chunks/r52qgGaC.js";import{r as Ve,f as Ke}from"../chunks/DHJ3Tc4X.js";import{a as Le,b as Me}from"../chunks/DgacYc9m.js";import{b as Re}from"../chunks/CA6OZ1r8.js";import{p as Ye}from"../chunks/mmOYl5Vi.js";import{B as ze}from"../chunks/Bh4T3gSW.js";import{C as se}from"../chunks/CLc_SRGS.js";import{B as Y}from"../chunks/B5ufFMg8.js";import{p as oe}from"../chunks/BDoOvnV6.js";import"../chunks/PuVCaejm.js";const Ge=!1,ht=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ge},Symbol.toStringTag,{value:"Module"}));var Je=f('<div class="h-10 w-48 rounded bg-[var(--border)]"></div> <div class="mt-4 h-4 w-64 rounded bg-[var(--border)]"></div>',1),Ue=f("<option> </option>"),We=f('<div class="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"></div> Deploying...',1),qe=f('<h2 class="text-lg font-semibold text-[var(--text-primary)]">Configuration</h2> <div class="mt-4"><label for="branch-select" class="mb-2 block text-sm font-medium text-[var(--text-primary)]">Branch</label> <select id="branch-select" class="w-full rounded-[var(--radius-md)] border border-[var(--border)] bg-white px-4 py-2.5 text-sm text-[var(--text-primary)] focus:border-[var(--primary)] focus:outline-none"></select></div> <div class="mt-4"><!></div> <div class="mt-4"><label class="flex items-center gap-3"><input type="checkbox" class="h-4 w-4 rounded border-[var(--border)] text-[var(--primary)] focus:ring-[var(--primary)]"/> <span class="text-sm text-[var(--text-primary)]">Enable auto-deploy on push</span></label></div> <div class="mt-4"><label for="env-vars" class="mb-2 block text-sm font-medium text-[var(--text-primary)]">Environment Variables (optional)</label> <textarea id="env-vars" placeholder="KEY=value ANOTHER_KEY=another_value" rows="4" class="w-full rounded-[var(--radius-md)] border border-[var(--border)] bg-white px-4 py-2.5 font-mono text-sm text-[var(--text-primary)] placeholder:text-[var(--text-muted)] focus:border-[var(--primary)] focus:outline-none"></textarea></div> <!>',1),Qe=f('<div class="h-2 w-2 animate-pulse rounded-full bg-yellow-500"></div> Deploying',1),Xe=f('<p class="text-[var(--text-muted)]">Waiting to start deployment...</p>'),Ze=f('<p class="whitespace-pre-wrap"> </p>'),et=f('<a href="/apps" class="mt-4 inline-flex items-center justify-center gap-2 rounded-[var(--radius-md)] bg-[var(--success)] px-4 py-2.5 text-sm font-medium text-white transition-colors hover:bg-green-600">View Apps â†’</a>'),tt=f('<div class="flex items-center justify-between"><h2 class="text-lg font-semibold text-[var(--text-primary)]">Deployment Logs</h2> <!></div> <div class="mt-4 flex-1 overflow-auto rounded-[var(--radius-md)] bg-[var(--bg-terminal)] p-4 font-mono text-sm text-green-400" style="min-height: 300px; max-height: 400px;"><!></div> <!>',1),at=f('<div class="grid gap-6 lg:grid-cols-2"><!> <!></div>'),rt=f('<div class="space-y-6"><div class="flex items-center gap-2 text-sm text-[var(--text-secondary)]"><a href="/github" class="hover:text-[var(--primary)]">GitHub</a> <span>â†’</span> <span class="font-medium text-[var(--text-primary)]"> </span></div> <div><h1 class="text-2xl font-bold text-[var(--text-primary)]"> </h1> <p class="mt-1 text-[var(--text-secondary)]"> </p></div> <!></div>');function bt(fe,_e){Ie(_e,!0);const ge=()=>Fe(Ye,"$page",xe),[xe,he]=He(),S=decodeURIComponent(ge().params.repo),[st,be]=S.split("/");let z=m(ce([])),B=m(""),T=m(null),Q=m(!0),G=m(""),le=m(!0),b=m(!1),ie=m(""),k=m(ce([])),I=m(!1),O=m(!1),A;Te(async()=>{await ye()});async function ye(){const s=await oe("/github/branches",{repoFullName:S});s.success&&s.data?.branches&&(r(z,s.data.branches,!0),e(z).length>0&&(r(B,e(z)[0].name,!0),await ne())),r(le,!1)}async function ne(){r(T,null);const s=await oe("/github/check-config",{repoFullName:S,ref:e(B)});r(T,s.data?.hasConfig??!1,!0)}async function $e(){if(!e(B)||e(b))return;r(b,!0),r(k,[],!0),r(I,!1),r(O,!1);const s={};e(G).trim()&&e(G).split(`
`).forEach(g=>{const[x,...F]=g.split("=");x&&(s[x.trim()]=F.join("=").trim())});const u=await oe("/github/import",{repoFullName:S,branch:e(B),webhookAutoDeploy:e(Q),env:s});u.success&&u.data?.deploymentId?(r(ie,u.data.deploymentId,!0),we()):(r(k,[`âŒ Failed to start deployment: ${u.message}`],!0),r(b,!1))}function we(){const s=new EventSource(`/api/github/deploy-stream/${e(ie)}`);s.onmessage=u=>{const g=JSON.parse(u.data);g.type==="log"?(r(k,[...e(k),g.message],!0),ke()):g.type==="end"&&(s.close(),r(b,!1),r(I,!0),r(O,e(k).some(x=>x.includes("âœ…")||x.includes("succeeded")),!0))},s.onerror=()=>{s.close(),r(b,!1),r(I,!0)}}function ke(){A&&(A.scrollTop=A.scrollHeight)}var X=rt(),Z=n(X),de=v(n(Z),4),Ce=n(de,!0);i(de),i(Z);var ee=v(Z,2),te=n(ee),Pe=n(te);i(te);var ve=v(te,2),Se=n(ve);i(ve),i(ee);var Be=v(ee,2);{var De=s=>{se(s,{class:"animate-pulse p-8",children:(u,g)=>{var x=Je();$(2),o(u,x)},$$slots:{default:!0}})},Ee=s=>{var u=at(),g=n(u);se(g,{children:(F,je)=>{var H=qe(),C=v(N(H),2),D=v(n(C),2);D.__change=ne,ue(D,21,()=>e(z),me,(a,d)=>{var l=Ue(),c=n(l,!0);i(l);var h={};q(()=>{j(c,e(d).name),h!==(h=e(d).name)&&(l.value=(l.__value=e(d).name)??"")}),o(a,l)}),i(D),i(C);var V=v(C,2),ae=n(V);{var E=a=>{Y(a,{variant:"outline",children:(d,l)=>{$();var c=R("Checking okastr8.yaml...");o(d,c)},$$slots:{default:!0}})},re=a=>{var d=W(),l=N(d);{var c=_=>{Y(_,{variant:"success",children:(M,y)=>{$();var P=R("âœ“ okastr8.yaml found");o(M,P)},$$slots:{default:!0}})},h=_=>{Y(_,{variant:"warning",children:(M,y)=>{$();var P=R("âš  No okastr8.yaml found");o(M,P)},$$slots:{default:!0}})};w(l,_=>{e(T)?_(c):_(h,!1)},!0)}o(a,d)};w(ae,a=>{e(T)===null?a(E):a(re,!1)})}i(V);var K=v(V,2),J=n(K),U=n(J);Ve(U),$(2),i(J),i(K);var L=v(K,2),t=v(n(L),2);Ae(t),i(L);var p=v(L,2);{let a=pe(()=>e(b)||!e(T));ze(p,{class:"mt-6 w-full",onclick:$e,get disabled(){return e(a)},children:(d,l)=>{var c=W(),h=N(c);{var _=y=>{var P=We();$(),o(y,P)},M=y=>{var P=R("ðŸš€ Start Deploy");o(y,P)};w(h,y=>{e(b)?y(_):y(M,!1)})}o(d,c)},$$slots:{default:!0}})}Ke(D,()=>e(B),a=>r(B,a)),Le(U,()=>e(Q),a=>r(Q,a)),Me(t,()=>e(G),a=>r(G,a)),o(F,H)},$$slots:{default:!0}});var x=v(g,2);se(x,{class:"flex flex-col",children:(F,je)=>{var H=tt(),C=N(H),D=v(n(C),2);{var V=t=>{{let p=pe(()=>e(O)?"success":"error");Y(t,{get variant(){return e(p)},children:(a,d)=>{$();var l=R();q(()=>j(l,e(O)?"âœ“ Success":"âœ• Failed")),o(a,l)},$$slots:{default:!0}})}},ae=t=>{var p=W(),a=N(p);{var d=l=>{Y(l,{variant:"warning",children:(c,h)=>{var _=Qe();$(),o(c,_)},$$slots:{default:!0}})};w(a,l=>{e(b)&&l(d)},!0)}o(t,p)};w(D,t=>{e(I)?t(V):t(ae,!1)})}i(C);var E=v(C,2),re=n(E);{var K=t=>{var p=Xe();o(t,p)},J=t=>{var p=W(),a=N(p);ue(a,17,()=>e(k),me,(d,l)=>{var c=Ze(),h=n(c,!0);i(c),q(()=>j(h,e(l))),o(d,c)}),o(t,p)};w(re,t=>{e(k).length===0?t(K):t(J,!1)})}i(E),Re(E,t=>A=t,()=>A);var U=v(E,2);{var L=t=>{var p=et();o(t,p)};w(U,t=>{e(I)&&e(O)&&t(L)})}o(F,H)},$$slots:{default:!0}}),i(u),o(s,u)};w(Be,s=>{e(le)?s(De):s(Ee,!1)})}i(X),q(()=>{j(Ce,S),j(Pe,`Deploy ${be??""}`),j(Se,`Configure and deploy from ${S??""}`)}),o(fe,X),Oe(),he()}Ne(["change"]);export{bt as component,ht as universal};
