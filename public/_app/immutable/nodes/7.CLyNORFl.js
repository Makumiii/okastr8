import{d as z,f as v,a,c as D,t as H,s as M}from"../chunks/ISW6cSpQ.js";import{d as f,c as h,g as t,b as p,r as m,f as C,n as L,s as e,t as Q}from"../chunks/D5eA8VJ5.js";import{i as I}from"../chunks/D7wiL91P.js";import{r as R}from"../chunks/DHJ3Tc4X.js";import{b as U}from"../chunks/DgacYc9m.js";import{B as X}from"../chunks/Bh4T3gSW.js";import{C as Y}from"../chunks/CLc_SRGS.js";var Z=v('<div class="flex flex-col items-center gap-4 text-center"><div class="h-8 w-8 animate-spin rounded-full border-4 border-[var(--primary)] border-t-transparent"></div> <div><h2 class="text-lg font-semibold text-[var(--text-primary)]">Waiting for Approval</h2> <p class="mt-1 text-sm text-[var(--text-secondary)]">An admin needs to approve your login request</p></div></div>'),ee=v('<div class="rounded-[var(--radius-md)] bg-[var(--error-light)] px-4 py-3 text-sm text-[var(--error)]"> </div>'),te=v('<div class="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"></div> Verifying...',1),re=v('<div class="w-full space-y-4"><div><label for="token" class="mb-2 block text-sm font-medium text-[var(--text-primary)]">API Token</label> <input id="token" type="password" placeholder="Enter your API token" class="w-full rounded-[var(--radius-md)] border border-[var(--border)] bg-white px-4 py-2.5 text-sm text-[var(--text-primary)] placeholder:text-[var(--text-muted)] focus:border-[var(--primary)] focus:outline-none focus:ring-2 focus:ring-[var(--primary)] focus:ring-offset-2"/></div> <!> <!></div> <p class="text-center text-xs text-[var(--text-muted)]">Generate tokens with <code class="font-mono">okastr8 auth create</code></p>',1),ae=v('<div class="flex flex-col items-center gap-6"><div class="flex items-center gap-3"><div class="flex h-12 w-12 items-center justify-center rounded-xl bg-[var(--primary)] text-2xl font-bold text-white">O</div> <span class="text-2xl font-semibold text-[var(--text-primary)]">okastr8</span></div> <!></div>'),se=v('<div class="flex min-h-screen items-center justify-center bg-[var(--bg-page)]"><!></div>');function fe(O){let u=p(""),c=p(!1),s=p(""),b=p(!1),j=p("");async function P(){if(!t(u).trim()){e(s,"Please enter your API token");return}e(c,!0),e(s,"");try{const i=await(await fetch("/api/auth/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t(u).trim()})})).json();if(!i.success){e(s,i.message||"Authentication failed",!0),e(c,!1);return}i.data?.pendingApproval?(e(b,!0),e(j,i.data.requestId,!0),S()):window.location.href="/"}catch{e(s,"Failed to connect to server")}finally{e(c,!1)}}async function S(){const r=setInterval(async()=>{try{const n=await(await fetch(`/api/auth/approval/${t(j)}`)).json();n.data?.status==="approved"?(clearInterval(r),window.location.href="/"):n.data?.status==="rejected"&&(clearInterval(r),e(b,!1),e(s,"Login request was rejected by admin"))}catch{}},3e3)}function T(r){r.key==="Enter"&&P()}var _=se(),B=f(_);Y(B,{class:"w-full max-w-md",children:(r,i)=>{var n=ae(),E=h(f(n),2);{var F=l=>{var x=Z();a(l,x)},G=l=>{var x=re(),$=C(x),w=f($),k=h(f(w),2);R(k),k.__keydown=T,m(w);var q=h(w,2);{var J=o=>{var g=ee(),y=f(g,!0);m(g),Q(()=>M(y,t(s))),a(o,g)};I(q,o=>{t(s)&&o(J)})}var K=h(q,2);X(K,{onclick:P,get disabled(){return t(c)},class:"w-full",children:(o,g)=>{var y=D(),N=C(y);{var V=d=>{var A=te();L(),a(d,A)},W=d=>{var A=H("Sign In");a(d,A)};I(N,d=>{t(c)?d(V):d(W,!1)})}a(o,y)},$$slots:{default:!0}}),m($),L(2),U(k,()=>t(u),o=>e(u,o)),a(l,x)};I(E,l=>{t(b)?l(F):l(G,!1)})}m(n),a(r,n)},$$slots:{default:!0}}),m(_),a(O,_)}z(["keydown"]);export{fe as component};
